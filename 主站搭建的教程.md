# 主站搭建教程（instreaman.cc）

本教程涵盖：本地构建、上传服务器、Caddy 配置与上线检查。

## 1. 本地构建

在开发电脑上执行构建命令，生成静态文件到 www/dist：

```bash
npm --prefix /home/instreaman/Code/instreaman.cc/www run build
```

构建完成后产物目录：

```
/home/instreaman/Code/instreaman.cc/www/dist
```

## 2. 上传到服务器

将 dist 上传到服务器站点目录（示例：/var/www/instreaman.cc）：

```bash
rsync -avz --delete /home/instreaman/Code/instreaman.cc/www/dist/ instreaman@ssh.instreaman.cc:/var/www/instreaman.cc/
```

> 若提示 Permission denied（无权限），请先在服务器上执行：
>
> ```bash
> sudo mkdir -p /var/www/instreaman.cc
> sudo chown -R instreaman:instreaman /var/www/instreaman.cc
> ```

## 3. 配置 Caddy

编辑 Caddyfile：

```bash
sudo nano /etc/caddy/Caddyfile
```

写入配置：

```text
instreaman.cc {
  root * /var/www/instreaman.cc
  encode gzip zstd
  file_server
}
```

校验并重载：

```bash
sudo caddy validate --config /etc/caddy/Caddyfile
sudo systemctl reload caddy
```

检查状态：

```bash
sudo systemctl status caddy
```

## 4. 上线检查

- 访问：`https://instreaman.cc`
- 若页面空白：确认目录 `root` 指向 `www/dist` 上传目录
- 若 404：确认 dist 已成功上传

## 5. 一键部署命令（可复制）

```bash
npm --prefix /home/instreaman/Code/instreaman.cc/www run build && rsync -avz --delete /home/instreaman/Code/instreaman.cc/www/dist/ instreaman@ssh.instreaman.cc:/var/www/instreaman.cc/
```

## 6. 常见问题

- **直接打开 dist/index.html 无反应**：请用 `npm run preview` 或线上服务器访问。
- **rsync 报错权限不足**：先在服务器上创建目录并赋权（见第 2 步）。
- **Caddy 不生效**：检查 Caddyfile 路径与重载是否成功。
